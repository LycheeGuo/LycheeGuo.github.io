{{/* Hugo Blox: Custom Resume Biography Block with Compact Education Style */}}
{{ $block := .Params }}
{{ $username := $block.content.username | default "admin" }}
{{ $page := site.GetPage (printf "authors/%s" $username) }}
{{ if not $page }}
  {{ errorf "UserProfile block: Could not find user '%s' at 'content/authors/%s/_index.md'" $username $username }}
{{ end }}

<div class="flex flex-col md:flex-row gap-12 justify-center">
  
  {{/* --- 左侧/上方：个人资料 (Avatar & Info) --- */}}
  <div class="md:w-1/3 lg:w-1/4 flex-shrink-0">
    <div class="text-center md:text-left sticky top-24">
       {{/* 头像处理 */}}
       {{ if $page.Params.avatar_filename }}
         {{ $avatar_image := resources.Get (printf "media/%s" $page.Params.avatar_filename) }}
         {{ if $avatar_image }}
            {{ $avatar_image := $avatar_image.Fill "250x250 Center" }}
            <img src="{{ $avatar_image.RelPermalink }}" class="rounded-full w-32 h-32 md:w-48 md:h-48 mx-auto md:mx-0 mb-6 object-cover shadow-lg border-2 border-white dark:border-gray-800">
         {{ end }}
       {{ end }}

       <h2 class="text-3xl font-bold mb-2 text-gray-900 dark:text-gray-100">{{ $page.Title }}</h2>
       <p class="text-lg text-gray-600 dark:text-gray-400 mb-6 font-light">{{ $page.Params.role }}</p>

       {{/* 社交链接 (Socials) */}}
       {{ if $page.Params.profiles }}
       <div class="flex flex-wrap gap-4 justify-center md:justify-start">
         {{ range $page.Params.profiles }}
           {{ $pack := or .icon_pack "fas" }}
           {{ $pack_prefix := $pack }}
           {{ if in (slice "fab" "fas" "far" "fal") $pack }}
             {{ $pack_prefix = "fa" }}
           {{ end }}
           <a href="{{ .url }}" target="_blank" rel="noopener" class="text-2xl text-gray-500 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors">
             <i class="{{ $pack }} {{ $pack_prefix }}-{{ .icon }}"></i>
           </a>
         {{ end }}
       </div>
       {{ end }}
       
       {{/* 下载简历按钮 */}}
       {{ if $block.content.button.text }}
       <div class="mt-8">
         <a href="{{ $block.content.button.url }}" class="inline-block bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-6 rounded-full transition-colors shadow-sm">
           {{ $block.content.button.text }}
         </a>
       </div>
       {{ end }}
    </div>
  </div>

  {{/* --- 右侧/主要区域：简介 + 教育背景 --- */}}
  <div class="md:w-2/3 lg:w-3/4 max-w-2xl">
    
    {{/* 1. 个人简介文本 */}}
    {{ if $page.Content }}
    <div class="prose dark:prose-invert max-w-none mb-12 text-gray-700 dark:text-gray-300">
      {{ $page.Content }}
    </div>
    {{ end }}

    {{/* 2. 教育背景 (Education) - 使用 Compact 样式 (仿照图二) */}}
    {{ if $page.Params.education }}
    <div class="mb-12">
      <h3 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-8 flex items-center">
        {{/* 可以在这里加个图标，例如 font-awesome 的 graduation-cap */}}
        <i class="fas fa-graduation-cap mr-3 text-indigo-600"></i> Education
      </h3>
      
      <div class="flex flex-col">
        {{ range $page.Params.education }}
          {{/* --- 这里完全复用了你提供的 compact.html 的核心 Flex 结构 --- */}}
          <div class="group relative flex flex-row gap-6 items-start border-b border-gray-100 dark:border-gray-800 pb-8 mb-8 last:border-0 last:pb-0 last:mb-0 overflow-hidden">
            
            {{/* 左侧文字 */}}
            <div class="flex-1 min-w-0 flex flex-col justify-between h-full">
              <div>
                <h3 class="text-lg md:text-xl font-bold text-gray-900 dark:text-gray-100 mb-2 leading-tight">
                  {{ .institution }}
                </h3>
                <div class="text-base text-gray-700 dark:text-gray-300 font-medium mb-2">
                  {{ .area }}
                </div>
                
                {{/* 描述/Summary */}}
                {{ if .summary }}
                  <div class="text-sm text-gray-600 dark:text-gray-400 prose dark:prose-invert max-w-none">
                    {{ .summary | markdownify | emojify }}
                  </div>
                {{ end }}
              </div>

              {{/* 底部日期 */}}
              <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-gray-500 dark:text-gray-500 mt-4 font-mono">
                <span>
                  {{ if .date_start }}{{ .date_start | time.Format "Jan 2006" }}{{ end }} 
                  - 
                  {{ if .date_end }}{{ .date_end | time.Format "Jan 2006" }}{{ else }}Present{{ end }}
                </span>
              </div>
            </div>

            {{/* 右侧图片 (Icon/Logo) - 仿照 compact.html 的右侧图片逻辑 */}}
            {{ if .icon }}
              {{/* 尝试获取 assets/media/icons/custom/... 下的图标 */}}
              {{ $iconPath := printf "media/icons/%s.svg" .icon }}
              {{ $iconRes := resources.Get $iconPath }}
              
              {{/* 如果找不到 svg，尝试找 png/jpg */}}
              {{ if not $iconRes }}
                 {{ $iconPath = printf "media/icons/%s.png" .icon }}
                 {{ $iconRes = resources.Get $iconPath }}
              {{ end }}

              {{ if $iconRes }}
              <div class="max-w-[30%] md:w-32 flex-shrink-0 pt-1">
                <div class="relative overflow-hidden rounded-lg border border-gray-100 dark:border-gray-700 shadow-sm bg-white dark:bg-gray-800 p-2">
                   <img src="{{ $iconRes.RelPermalink }}" 
                        alt="{{ .institution }}" 
                        class="w-full h-auto object-contain transform group-hover:scale-105 transition-transform duration-500">
                </div>
              </div>
              {{ end }}
            {{ end }}

          </div>
        {{ end }}
      </div>
    </div>
    {{ end }}

  </div>
</div>
